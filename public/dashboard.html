<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard - Stamp-die-kaart</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Arial; background:#f5fffb; margin:0; padding:20px; }
    .wrap { max-width:980px; margin:0 auto; }
    h1 { margin-top:0; }
    .cards { display:flex; gap:12px; flex-wrap:wrap; }
    .card { flex:1; min-width:200px; background:rgba(255,255,255,0.85); padding:16px; border-radius:12px; box-shadow:0 6px 20px rgba(3,7,18,0.05); }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th,td { text-align:left; padding:8px; border-bottom:1px solid #eee; }
    .top-list { margin-top:12px; }
    .refresh { margin-left:auto; padding:10px 14px; border-radius:8px; border:0; background:#00b894; color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Dashboard</h1>
    <div style="display:flex; align-items:center;">
      <div style="flex:1">Live statistieken</div>
      <button id="refresh" class="refresh">Ververs</button>
    </div>
    <div class="cards" id="stats"></div>

    <h2>Top 5 klanten</h2>
    <div class="card top-list">
      <table id="topTable">
        <thead><tr><th>#</th><th>Naam</th><th>Telefoon</th><th>Stempels</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    async function load() {
      const res = await fetch("/api/stats/overview");
      const json = await res.json();
      const stats = document.getElementById("stats");
      stats.innerHTML = "";
      const items = [
        { title: "Totaal klanten", value: json.totalCustomers },
        { title: "Stempels vandaag", value: json.stampsToday },
        { title: "Ingewisselde beloningen", value: json.redeemedCount }
      ];
      for (const it of items) {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `<strong style="font-size:18px">${it.value}</strong><div style="margin-top:8px">${it.title}</div>`;
        stats.appendChild(el);
      }

      const tbody = document.querySelector("#topTable tbody");
      tbody.innerHTML = "";
      json.top.forEach((t, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${i+1}</td><td>${t.name}</td><td>${t.phone}</td><td>${t.count}</td>`;
        tbody.appendChild(tr);
      });
    }

    document.getElementById("refresh").addEventListener("click", load);
    load();

    const sse = new EventSource("/sse");
    sse.addEventListener("stamp", e => load());
    sse.addEventListener("redeem", e => load());
  </script>
</body>
</html>
